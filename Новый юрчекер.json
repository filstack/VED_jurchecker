{
  "name": "–ù–æ–≤—ã–π —é—Ä—á–µ–∫–µ—Ä",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "http://93.189.231.235:8001/check-candidates",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ text: $json[\"–¢–µ–∫—Å—Ç\"] }) }}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -960,
        -144
      ],
      "id": "52a281b9-b31f-487e-8d2a-99706fb76823",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -112,
        80
      ],
      "id": "533bc542-b2af-4faa-a761-c6cfae64e7ec",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "–¢–≤–æ—è —Ä–æ–ª—å: –°–≤–µ—Ä—Ö—Ç–æ—á–Ω—ã–π —é—Ä–∏—Å—Ç-–∞–Ω–∞–ª–∏—Ç–∏–∫ –ø–æ –∫–æ–º–ø–ª–∞–µ–Ω—Å—É –≤ —Ä–æ—Å—Å–∏–π—Å–∫–æ–º –°–ú–ò. –¢–≤–æ—è –≥–ª–∞–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –æ—Ç—Å–µ–∏–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è, –≤—ã–∑–≤–∞–Ω–Ω—ã–µ —Ç–µ–º, —á—Ç–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–±—â–∏–µ —Å–ª–æ–≤–∞. –ë—É–¥—å –ø—Ä–µ–¥–µ–ª—å–Ω–æ —Å–∫–µ–ø—Ç–∏—á–µ–Ω.",
        "messages": {
          "messageValues": [
            {
              "message": "=\n–í–æ—Ç –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π:\n–ü—Ä–∏–º–µ—Ä 1:\n- –°—É—â–Ω–æ—Å—Ç—å: \"–§–∞–∫—Ç–æ–≥—Ä–∞—Ñ\"\n- –ü—Å–µ–≤–¥–æ–Ω–∏–º: \"—Ñ–∞–∫—Ç\"\n- –ö–æ–Ω—Ç–µ–∫—Å—Ç: \"...–Ω—É–∂–Ω–æ –¥–æ–∫–∞–∑–∞—Ç—å —Ñ–∞–∫—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è...\"\n- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {\"is_true_positive\": false, \"reason\": \"–°–ª–æ–≤–æ '—Ñ–∞–∫—Ç' –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –≤ —Å–≤–æ–µ–º –ø—Ä—è–º–æ–º –ª–µ–∫—Å–∏—á–µ—Å–∫–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏, –∞ –Ω–µ –∫–∞–∫ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞.\"}\n–ü—Ä–∏–º–µ—Ä 2:\n- –°—É—â–Ω–æ—Å—Ç—å: \"–ü–µ—Ä–ª –†–æ–º–∞–Ω –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á\"\n- –ü—Å–µ–≤–¥–æ–Ω–∏–º: \"—Ä–æ–º–∞–Ω\"\n- –ö–æ–Ω—Ç–µ–∫—Å—Ç: \"–ê–≤—Ç–æ—Ä —Å—Ç–∞—Ç—å–∏ - –†–æ–º–∞–Ω –†–æ–º–∞–Ω–æ–≤...\"\n- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {\"is_true_positive\": false, \"reason\": \"–°–ª–æ–≤–æ '–†–æ–º–∞–Ω' —è–≤–ª—è–µ—Ç—Å—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º –∏ –≤ –¥–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –¥—Ä—É–≥–æ–º—É —á–µ–ª–æ–≤–µ–∫—É.\"}\n–ü—Ä–∏–º–µ—Ä 3:\n- –°—É—â–Ω–æ—Å—Ç—å: \"The Insider\"\n- –ü—Å–µ–≤–¥–æ–Ω–∏–º: \"the insider\"\n- –ö–æ–Ω—Ç–µ–∫—Å—Ç: \"...–æ–± —ç—Ç–æ–º —Å–æ–æ–±—â–∏–ª–æ –∏–∑–¥–∞–Ω–∏–µ The Insider...\"\n- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {\"is_true_positive\": true, \"reason\": \"–ö–æ–Ω—Ç–µ–∫—Å—Ç (—É–ø–æ–º–∏–Ω–∞–Ω–∏–µ '–∏–∑–¥–∞–Ω–∏–µ') –ø—Ä—è–º–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –°–ú–ò —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º.\"}\n\n–¢–µ–ø–µ—Ä—å –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:\n\n- –°—É—â–Ω–æ—Å—Ç—å: \"{{$json.entity_name}}\"\n- –¢–∏–ø —Å—É—â–Ω–æ—Å—Ç–∏: \"{{$json.entity_type}}\"\n- –ù–∞–π–¥–µ–Ω–Ω—ã–π –ø—Å–µ–≤–¥–æ–Ω–∏–º: \"{{$json.found_alias}}\"\n- –ö–æ–Ω—Ç–µ–∫—Å—Ç: \"{{$json.context}}\"\n\n–í–µ—Ä–Ω–∏ —Å–≤–æ–π –æ—Ç–≤–µ—Ç –°–¢–†–û–ì–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:\n{\n  \"is_true_positive\": boolean, // true, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—ã –Ω–∞ 99% —É–≤–µ—Ä–µ–Ω, —á—Ç–æ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ. –ò–Ω–∞—á–µ ‚Äî false.\n  \"is_distribution\": boolean, // true, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–∏–ø —Å—É—â–Ω–æ—Å—Ç–∏ \"–Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ\" –ò –≤ —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å –Ø–í–ù–´–ô –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é. –ò–Ω–∞—á–µ ‚Äî false.\n  \"reason\": \"–ö—Ä–∞—Ç–∫–æ–µ –∏ —á–µ—Ç–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Ç–≤–æ–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è.\""
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        112,
        80
      ],
      "id": "4a56bfca-291c-4d54-9e60-c803dff1b282",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "jsCode": "const item = items[0];\nlet aiResponseText = item.json.text;\n\n// --- –ù–û–í–´–ô –ë–õ–û–ö –û–ß–ò–°–¢–ö–ò ---\n// –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª–∏ –æ–±–æ—Ä–∞—á–∏–≤–∞—é—Ç JSON –≤ markdown.\n// –≠—Ç–æ—Ç –∫–æ–¥ –Ω–∞—Ö–æ–¥–∏—Ç –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —á–∏—Å—Ç—ã–π JSON –∏–∑ —Ç–∞–∫–æ–π —Å—Ç—Ä–æ–∫–∏.\nconst jsonMatch = aiResponseText.match(/```json\\n([\\s\\S]*?)\\n```/);\nif (jsonMatch && jsonMatch[1]) {\n  aiResponseText = jsonMatch[1];\n}\n// --- –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ë–õ–û–ö–ê ---\n\ntry {\n  // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –û–ß–ò–©–ï–ù–ù–´–ô —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞\n  const parsedJson = JSON.parse(aiResponseText);\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º –∫ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω–æ–º—É JSON –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞\n  item.json.ai_verification = parsedJson;\n} catch (e) {\n  // –ï—Å–ª–∏ –ò–ò –≤–µ—Ä–Ω—É–ª –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON –¥–∞–∂–µ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏\n  item.json.ai_verification = {\n    is_true_positive: false,\n    is_distribution: false,\n    reason: \"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç –ò–ò: \" + aiResponseText\n  };\n}\n\nreturn item;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        208
      ],
      "id": "c145a764-ebc1-4147-a814-9fb988511242",
      "name": "Parse AI Response"
    },
    {
      "parameters": {
        "jsCode": "// –†–∞–∑–±–∏–≤–∞–µ–º payload –Ω–∞ items –ø–æ –∫–∞–∂–¥–æ–º—É candidate\n// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º 3 —Å–ª—É—á–∞—è:\n// 1) item.json = { candidates: [...] }\n// 2) item.json = \"[{...}]\" (JSON-—Å—Ç—Ä–æ–∫–∞)\n// 3) item.json = [{ candidates: [...] }] (–º–∞—Å—Å–∏–≤-–æ–±–µ—Ä—Ç–∫–∞)\n\nconst out = [];\n\nfor (const [i, item] of items.entries()) {\n  let payload = item.json;\n\n  // –ï—Å–ª–∏ –ø—Ä–∏—à–ª–∞ —Å—Ç—Ä–æ–∫–∞ ‚Äî –ø—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å\n  if (typeof payload === 'string') {\n    try {\n      payload = JSON.parse(payload);\n    } catch (e) {\n      // –Ω–µ –ø–∞—Ä—Å–∏—Ç—Å—è ‚Äî –æ—Å—Ç–∞–≤–∏–º –∫–∞–∫ –µ—Å—Ç—å\n    }\n  }\n\n  // –ï—Å–ª–∏ –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å ‚Äî –º–∞—Å—Å–∏–≤ (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ)\n  if (Array.isArray(payload)) {\n    for (const [j, wrapper] of payload.entries()) {\n      const candidates = (wrapper && Array.isArray(wrapper.candidates)) ? wrapper.candidates : [];\n      for (const [k, c] of candidates.entries()) {\n        out.push({\n          json: {\n            ...c, // entity_id, entity_name, entity_type, found_alias, context\n            source_item_index: i,\n            wrapper_index: j,\n            candidate_index: k,\n          },\n        });\n      }\n    }\n    continue;\n  }\n\n  // –ï—Å–ª–∏ –æ–±—ã—á–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º candidates\n  if (payload && Array.isArray(payload.candidates)) {\n    for (const [k, c] of payload.candidates.entries()) {\n      out.push({\n        json: {\n          ...c,\n          source_item_index: i,\n          candidate_index: k,\n        },\n      });\n    }\n    continue;\n  }\n\n  // –ï—Å–ª–∏ candidates –Ω–µ—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º\n  out.push({ json: payload });\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -576,
        -144
      ],
      "id": "fdf9922a-769f-47ce-99e6-97dc763ed089",
      "name": "items"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        176,
        -224
      ],
      "id": "5ad7739b-eace-40cb-af2f-f495e8e94ec8",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "jsCode": "// === –í—Å–ø–æ–º–æ–≥–∞–ª–∫–∏ ===\nconst safeLower = (s) => (typeof s === 'string' ? s.toLowerCase() : '');\nconst keyOf = (it) => it.entity_id && String(it.entity_id).length > 0\n  ? `id:${it.entity_id}`\n  : `name:${safeLower(it.entity_name || '')}`;\nconst toBool = (v) => (v === true || v === 'true'); // –Ω–∞ —Å–ª—É—á–∞–π —Å—Ç—Ä–æ–∫ \"true\"/\"false\"\nconst betterOf = (a, b) => {\n  const ca = (a.confidence ?? 0);\n  const cb = (b.confidence ?? 0);\n  if (cb > ca) return b;\n  if (cb < ca) return a;\n  if (!!b.is_distribution && !a.is_distribution) return b;\n  return a;\n};\n\n// === –ß–∏—Ç–∞–µ–º –ò–ú–ï–ù–ù–û –≤—Ö–æ–¥ —ç—Ç–æ–π Code-–Ω–æ–¥—ã (–ø–æ—Å–ª–µ Merge) ===\nconst all = $input.all().map(i => i.json);\n\nif (!all.length) {\n  return [{\n    json: {\n      status: '‚ö†Ô∏è PIPELINE_ERROR',\n      summary: '–ù–∞ –≤—Ö–æ–¥ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –Ω–æ–¥—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–∏—à–ª–æ (–ø–æ—Å–ª–µ Merge).',\n      details: []\n    }\n  }];\n}\n\n// –ì–æ—Ç–æ–≤–∏–º —Å–ø–∏—Å–æ–∫\nconst prepared = [];\nlet withVerification = 0;\n\nfor (const j of all) {\n  const v = j.ai_verification;\n  if (v) withVerification++;\n\n  if (!v) continue;\n  if (!toBool(v.is_true_positive)) continue;\n\n  prepared.push({\n    entity_id: j.entity_id ?? null,\n    entity_name: j.entity_name ?? null,\n    entity_type: j.entity_type ?? null,\n    found_alias: j.found_alias ?? null,\n    context_fragment: j.context ?? null,\n    is_distribution: toBool(v.is_distribution),\n    reason: v.reason ?? null,\n    confidence: (typeof v.confidence === 'number') ? v.confidence : null\n  });\n}\n\n// –ï—Å–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ—Ç ai_verification ‚Äî —ç—Ç–æ –ø–æ–ª–æ–º–∫–∞ –¥–æ Merge\nif (withVerification === 0) {\n  return [{\n    json: {\n      status: '‚ö†Ô∏è PIPELINE_ERROR',\n      summary: '–ü–æ—Å–ª–µ Merge —É –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ai_verification. –ü—Ä–æ–≤–µ—Ä—å –≤–µ—Ç–∫—É –∫ –ò–ò –∏ —Å–∫–ª–µ–π–∫—É.',\n      details: []\n    }\n  }];\n}\n\n// –î–µ–¥—É–ø\nconst byKey = new Map();\nfor (const it of prepared) {\n  const k = keyOf(it);\n  if (!k || k === 'name:') continue;\n  const prev = byKey.get(k);\n  byKey.set(k, prev ? betterOf(prev, it) : it);\n}\nconst deduped = Array.from(byKey.values());\n\n// –°–≤–æ–¥–∫–∞\nif (deduped.length === 0) {\n  return [{\n    json: {\n      status: '‚úÖ OK',\n      summary: '–ù–∞—Ä—É—à–µ–Ω–∏–π –∏–ª–∏ —Ä–∏—Å–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.',\n      details: []\n    }\n  }];\n}\n\nconst total = deduped.length;\nconst uniqueEntities = new Set(\n  deduped.map(it => it.entity_id ? `id:${it.entity_id}` : `name:${safeLower(it.entity_name || '')}`)\n).size;\nconst distributions = deduped.filter(it => it.is_distribution).length;\nconst mentions = total - distributions;\n\nreturn [{\n  json: {\n    status: '‚ö†Ô∏è –†–∏—Å–∫/–∏–Ω—Ñ–æ—Ä–º',\n    summary: `–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö —É–ø–æ–º–∏–Ω–∞–Ω–∏–π: ${total} (—É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π: ${uniqueEntities}; —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ: ${distributions}; —É–ø–æ–º–∏–Ω–∞–Ω–∏—è: ${mentions}).`,\n    details: deduped.map(it => ({\n      entity_id: it.entity_id,\n      entity_name: it.entity_name,\n      type: it.entity_type,\n      found_alias: it.found_alias,\n      is_distribution: it.is_distribution,\n      ai_reason: it.reason,\n      confidence: it.confidence,\n      context_fragment: it.context_fragment\n    }))\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        -288
      ],
      "id": "525c7d7b-5ad6-4edf-aed3-6c1248f8be8d",
      "name": "Code"
    },
    {
      "parameters": {
        "model": "google/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        192,
        304
      ],
      "id": "17e93cdc-1c65-460e-b10f-a93082009de8",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "VonBdQoCx0vWMuYV",
          "name": "–Æ–†–ß–ï–ö–ï–†"
        }
      }
    },
    {
      "parameters": {
        "content": "## http://93.189.231.235:8001/docs\n/root/jurchecker_project/\n",
        "height": 144,
        "width": 496
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1200,
        -512
      ],
      "typeVersion": 1,
      "id": "9793d96c-315f-4f1d-bc66-da197537dd72",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "jsCode": "// –≠—Ç–æ—Ç –∫–æ–¥ –Ω–∞—Ö–æ–¥–∏—Ç –º–∞—Å—Å–∏–≤ 'candidates' –∏ –æ—á–∏—â–∞–µ—Ç –µ–≥–æ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.\n// –û–Ω —É—Å—Ç–æ–π—á–∏–≤ –∫ —Ä–∞–∑–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∞–º –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.\n\nconst item = items[0];\nlet candidates = [];\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—É—Ç–µ–π, –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç—ã\nif (item.json.body && Array.isArray(item.json.body.candidates)) {\n  // –°–ª—É—á–∞–π, –∫–æ–≥–¥–∞ –æ—Ç–≤–µ—Ç –æ—Ç HTTP Request –æ–±–µ—Ä–Ω—É—Ç –≤ body\n  candidates = item.json.body.candidates;\n} else if (Array.isArray(item.json.candidates)) {\n  // –°–ª—É—á–∞–π, –∫–æ–≥–¥–∞ candidates –ª–µ–∂–∞—Ç –ø—Ä—è–º–æ –≤ json\n  candidates = item.json.candidates;\n} else {\n  // –ï—Å–ª–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n  return [{ json: { candidates: [] } }];\n}\n\n\nif (candidates.length === 0) {\n  return [{ json: { candidates: [] } }];\n}\n\n// –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –æ—Ç —Å–∞–º–æ–≥–æ –¥–ª–∏–Ω–Ω–æ–≥–æ –ø—Å–µ–≤–¥–æ–Ω–∏–º–∞ –∫ —Å–∞–º–æ–º—É –∫–æ—Ä–æ—Ç–∫–æ–º—É\ncandidates.sort((a, b) => b.found_alias.length - a.found_alias.length);\n\nconst final_candidates = [];\nconst processed_contexts = new Set(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º Set –¥–ª—è –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏\n\nfor (const current_candidate of candidates) {\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ –ª–∏ –º—ã —É–∂–µ —ç—Ç–æ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞\n  if (processed_contexts.has(current_candidate.context)) {\n    continue;\n  }\n\n  let is_duplicate_or_subset = false;\n\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π –∫–∞–Ω–¥–∏–¥–∞—Ç —á–∞—Å—Ç—å—é —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ, –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω–æ–≥–æ\n  for (const final_item of final_candidates) {\n    if (final_item.context.includes(current_candidate.context) && \n        final_item.found_alias.includes(current_candidate.found_alias)) {\n      is_duplicate_or_subset = true;\n      break;\n    }\n  }\n\n  if (!is_duplicate_or_subset) {\n    final_candidates.push(current_candidate);\n    processed_contexts.add(current_candidate.context);\n  }\n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—á–∏—â–µ–Ω–Ω—ã–π –∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫\nreturn [{ json: { candidates: final_candidates } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -768,
        -144
      ],
      "id": "184b3f8f-b581-46cc-9a61-8fd833451e2d",
      "name": "Deduplicate & Prioritize"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        464,
        -288
      ],
      "id": "09a5d30d-7111-4a81-a608-2fe2f5de04ba",
      "name": "Merge"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "cbc06779-2c6b-460d-8803-e96716068e6d",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1360,
        -144
      ],
      "id": "19c21e2f-7bed-4569-b381-a3c98437554a",
      "name": "Webhook1",
      "webhookId": "cbc06779-2c6b-460d-8803-e96716068e6d"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:\n\n{{ $json.summary }}\n\n‚ö†Ô∏è –û–±—ä–µ–∫—Ç: {{ $json.details[0].entity_name }}\nüìå –ü—Ä–∏—á–∏–Ω–∞: {{ $json.details[0].ai_reason }}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        880,
        -288
      ],
      "id": "fa0cab4e-9851-4e2f-8249-945a19fa0982",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1VkLbc5n_UkeNV4vnErGUkiM-hmHXPWMvqCrlwQqXmXE",
          "mode": "list",
          "cachedResultName": "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —é—Ä—á–µ–∫–µ—Ä",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1VkLbc5n_UkeNV4vnErGUkiM-hmHXPWMvqCrlwQqXmXE/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "–õ–∏—Å—Ç1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1VkLbc5n_UkeNV4vnErGUkiM-hmHXPWMvqCrlwQqXmXE/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "–¢–µ–∫—Å—Ç": "={{ $json.body.text }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–î–∞—Ç–∞",
              "displayName": "–î–∞—Ç–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–¢–µ–∫—Å—Ç",
              "displayName": "–¢–µ–∫—Å—Ç",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–†–µ–∑—É–ª—å—Ç–∞—Ç ",
              "displayName": "–†–µ–∑—É–ª—å—Ç–∞—Ç ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1152,
        -144
      ],
      "id": "3977b6db-20a1-41f9-bb0e-20640416a079",
      "name": "Append row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "k2BfOTw7PmrQtmSa",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "pinData": {
    "Webhook1": [
      {
        "json": {
          "headers": {
            "host": "n8n.flowzilla.ru",
            "x-forwarded-scheme": "https",
            "x-forwarded-proto": "https",
            "x-forwarded-for": "185.174.40.67",
            "x-real-ip": "185.174.40.67",
            "content-length": "56",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:143.0) Gecko/20100101 Firefox/143.0",
            "accept": "*/*",
            "accept-language": "ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3",
            "accept-encoding": "gzip, deflate, br, zstd",
            "referer": "https://justphil0702-lawchecker.static.hf.space/",
            "content-type": "application/json",
            "origin": "https://justphil0702-lawchecker.static.hf.space",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "cross-site",
            "priority": "u=0"
          },
          "params": {},
          "query": {},
          "body": {
            "text": "—Ñ–æ–Ω–¥ –±–æ—Ä—å–±—ã —Å –∫–æ—Ä—Ä—É–ø—Ü–∏–µ–π"
          },
          "webhookUrl": "https://n8n.flowzilla.ru/webhook/cbc06779-2c6b-460d-8803-e96716068e6d",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Deduplicate & Prioritize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Parse AI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "items": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Parse AI Response": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Deduplicate & Prioritize": {
      "main": [
        [
          {
            "node": "items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "40594753-856c-4727-af89-00033a1f4faa",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "bffad4c9f83acfd6463e64d51eb0cabef751637efb0493829ed8453fbbddb165"
  },
  "id": "ZcJPa2ycGR9Q6sN3",
  "tags": []
}